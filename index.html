<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Spider</title>
  <link rel="stylesheet" href="style.css">
  <!-- Howler.js for audio -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js" integrity="sha512-xi/RZRIF/S0hJ+yJJYuZ5yk6/8pCiRlEXZzoguSMl+vk2i3m6UjUO/WcZ11blRL/O+rnj94JRGwt/CHbc9+6EA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div id="hud">
      <div id="top-bar">
      <div style="display: flex; gap: 15px; align-items: center;">
        <div>David's Spider - v0.0.10</div>
        <div>Time: <span id="time">0:00</span></div>
        <div>Moves: <span id="moves">0</span></div>
        <div>Score: <span id="score">500</span></div>
        <div>Deals: <span id="deals">5</span></div>
        <div style="color: #22c55e; font-weight: 600;">Sets: <span id="sets-counter" style="color: white;">0</span></div>
        <div class="pill">Seed: <span id="seedLabel"></span></div>
      </div>
      <button id="showStats">üìä Stats</button>
      <button id="showSettings" aria-label="Settings" title="Settings">‚öôÔ∏è</button>
    </div>
  </div>

  <div id="menu-bar">
    <div class="card menu-panel">
      <div class="menu-section-title">Actions</div>
      <div class="menu-actions">
        <button id="newBtn" class="bubble-btn" data-label="New Game" title="N" style="width: 100%; text-align: left;">New Game</button>
        <button id="replayBtn" class="bubble-btn" data-label="Replay" title="Replay seed" style="width: 100%; text-align: left;">Replay</button>
        <button id="undoBtn" class="bubble-btn" data-label="Undo" title="U" style="width: 100%; text-align: left;">Undo</button>
        <button id="redoBtn" class="bubble-btn" data-label="Redo" title="R" style="width: 100%; text-align: left;">Redo</button>
        <button id="hintBtn" class="bubble-btn" data-label="Hint" title="H" style="width: 100%; text-align: left;">Hint</button>
        <button id="dealBtn" class="bubble-btn" data-label="Deal" title="D" style="width: 100%; text-align: left;">Deal</button>
      </div>

      <div class="menu-seed-row">
        <input id="seedInput" type="text" placeholder="custom seed" style="flex: 1; padding: 6px; font-size: 0.9em;" title="Enter a custom seed to replay or share a game"/>
        <button id="setSeedBtn" style="padding: 0 8px;" title="Apply custom seed">Set</button>
      </div>

      <div class="menu-footer">
        <div class="menu-footer-row">
          <button id="verifyBtn" class="bubble-btn" data-label="Verify" title="Check deck & invariants" style="width: 100%; padding: 6px;">Verify</button>
        </div>
      </div>
    </div>
    <span id="dealReason" class="pill" style="display:none; margin-top: 6px; text-align: center; font-size: 0.9em;"></span>
  </div>

  <canvas id="game"></canvas>

  <div id="winModal" class="modal">
    <div class="modal-content" style="font-size: 1.5em;">
      <h2 style="font-size: 2em; margin-bottom: 20px;">ü¶ö You Win!</h2>
      <div class="win-stats" style="line-height: 1.8;">
        <div>Time: <b id="winTime">0:00</b></div>
        <div>Moves: <b id="winMoves">0</b></div>
        <div>Score: <b id="winScore">0</b></div>
        <div>Difficulty: <b id="winDifficulty">1-suit</b></div>
        <div>Wins: <b id="winRate">-</b> (<span id="winRateCount">-</span> games)</div>
        <div>Seed: <b id="winSeed">abc123</b></div>
      </div>
      <div class="modal-buttons" style="margin-top: 20px;">
        <button id="playAgain" style="font-size: 0.9em; padding: 8px 16px;">Play again</button>
        <button id="shareSeed" style="font-size: 0.9em; padding: 8px 16px;">Share seed</button>
      </div>
    </div>
  </div>

  <div id="hintModal" class="modal">
    <div class="modal-content">
      <h2>üí° Available Moves</h2>
      <div id="hintList" class="hint-list"></div>
      <div class="modal-buttons">
        <button id="closeHint">Close</button>
      </div>
    </div>
  </div>

  <!-- Statistics Modal -->
  <div id="statsModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
      <h2>üìä Game Statistics</h2>
      <div class="stats-container">
        <div class="stats-section">
          <h3>Overall Statistics</h3>
          <div id="overallStats" class="stats-grid"></div>
        </div>
        <div class="stats-section">
          <h3>Recent Games</h3>
          <div id="recentGames" class="recent-games"></div>
        </div>
      </div>
      <div class="modal-buttons">
        <button id="clearStats" class="clear-btn">Clear All</button>
        <button id="closeStats">Close</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content" style="max-width: 480px;">
      <h2>‚öôÔ∏è Settings</h2>
      <div class="stats-container">
        <div class="stats-section">
          <h3>Difficulty</h3>
          <select id="difficulty" style="width: 100%; padding: 10px; font-size: 1em;">
            <option value="1-suit">1-suit</option>
            <option value="2-suit" selected>2-suit</option>
            <option value="4-suit">4-suit</option>
          </select>
        </div>
        <div class="stats-section">
          <h3>Rules</h3>
          <label style="display: flex; align-items: center; gap: 8px; font-size: 1em;">
            <input type="checkbox" id="includeAces">
            <span>Include Aces</span>
          </label>
        </div>
        <div class="stats-section">
          <h3>Audio</h3>
          <button id="muteBtn" style="width: 100%; padding: 10px;">üîä Toggle Sound</button>
        </div>
      </div>
      <div class="modal-buttons">
        <button id="closeSettings">Close</button>
      </div>
    </div>
  </div>

  <script src="history.js"></script>
  <script type="module" src="renderUI.js"></script>
</body>
</html>
